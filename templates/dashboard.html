{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}
{% block page_title %}Resumen del Inventario{% endblock %}

{% block content %}

<style>
    .dashboard-container {
        max-width: 1100px;
        margin: auto;
    }

    .summary-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }

    .summary-card {
        padding: 25px;
        border-radius: 22px;
        color: white;
        text-align: center;
        font-weight: 600;
        cursor: pointer;
        transition: transform .25s ease, box-shadow .25s ease;
    }

    .summary-card:hover {
        transform: translateY(-6px);
        box-shadow: 0px 10px 28px rgba(0,0,0,0.25);
    }

    .summary-products {
        background: linear-gradient(140deg, #5A8DFF, #7F6CFF);
    }

    .summary-low {
        background: linear-gradient(140deg, #FFA26B, #FF6C6C);
    }

    .summary-icon {
        font-size: 45px;
        margin-bottom: 10px;
        opacity: .9;
    }

    .chart-card {
        border-radius: 20px;
        background: white;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.10);
        margin-bottom: 25px;
    }

    .chart-container {
        width: 100%;
        height: 300px;
    }
</style>

<div class="dashboard-container">

    <div class="summary-row">
        <div class="summary-card summary-products">
            <div class="summary-icon">üì¶</div>
            <h4>Total de productos</h4>
            <p id="countProducts" style="font-size:40px; font-weight:bold;">0</p>
        </div>

        <div class="summary-card summary-low">
            <div class="summary-icon">‚ö†Ô∏è</div>
            <h4>Stock bajo</h4>
            <p id="countLow" style="font-size:40px; font-weight:bold;">0</p>
        </div>
    </div>

    <div class="chart-card">
        <h3 style="text-align:center;">Productos por categor√≠a</h3>
        <div class="chart-container"><canvas id="chartCat"></canvas></div>
    </div>

    <div class="chart-card">
        <h3 style="text-align:center;">Estado del Inventario</h3>
        <div class="chart-container"><canvas id="chartStock"></canvas></div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const labels = {{ labels | tojson }};
    const values = {{ values | tojson }};
    const totalProducts = {{ total_products }};
    const lowStock = {{ low_stock }};

    const animateCounter = (id, target) => {
        let obj = document.getElementById(id);
        let count = 0;
        let step = Math.max(1, Math.floor(target / 30));
        let interval = setInterval(() => {
            count += step;
            if(count >= target){
                count = target;
                clearInterval(interval);
            }
            obj.innerText = count;
        }, 20);
    };

    window.onload = () => {
        animateCounter("countProducts", totalProducts);
        animateCounter("countLow", lowStock);
    };

    new Chart(document.getElementById("chartCat"), {
        type: "bar",
        data: {
            labels,
            datasets: [{
                label: "Productos",
                data: values,
                backgroundColor: ["#6a9cffdd","#9f7bffdd","#ff9e8edd","#ff6e6edd","#68e1c8dd"],
                borderRadius: 16
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: { y: { beginAtZero: true } }
        }
    });

    new Chart(document.getElementById("chartStock"), {
        type: "doughnut",
        data: {
            labels: ["Stock suficiente", "Stock bajo"],
            datasets: [{
                data: [totalProducts - lowStock, lowStock],
                backgroundColor: ["#4ade80", "#ff6e6e"],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            cutout: "65%",
            plugins: {
                legend: { position: "bottom" }
            }
        }
    });
</script>

{% endblock %}



